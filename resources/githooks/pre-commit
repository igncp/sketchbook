set -e

npm run lint

git rm dist/index.js --cached || true
git rm dist/index.js.map --cached || true
git rm dist/diagrams-collection --cached || true

rm -rf dist/index.js
rm -rf dist/index.js.map

# gh-pages deploy doesn't handle well symlinks
# pointing outside the repo, even those not used
rm -rf dist/diagrams-collection

npm run build-prod
npm run generate-html-files
npm run generate-routes